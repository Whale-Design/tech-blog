# DNS(域名系统)解析过程 
## DNS定义  
==DNS(Domain Name System,域名系统)==,万维网上作为域名和IP地址相互映射的一个==分布式数据库==，能够使用户更加方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。==通过域名，最终得到该域名对应的IP地址的过程就是域名解析==。
 
## 下面这张图详细说明了一个DNS域名解析的全过程： 

![image](http://www.maixj.net/wp-content/uploads/2015/10/dns.jpg)  

### DNS域名解析的过程:

1， 网络客户端就是我们平常使用的电脑，打开浏览器，输入一个域名。比如输入www.163.com，浏览器首先会在自己的缓存中查找是否有该域名对应的IP地址，浏览器缓存中无域名对应IP则会自动检查用户计算机系统Hosts文件DNS缓存是否有该域名对应IP，当浏览器及系统缓存中均无域名对应IP则进入路由器缓存中检查，以上三步均为客户端DNS缓存，当在用户客服端查找不到域名对应IP地址时，客户端会发出一个DNS请求到本地DNS服务器。本地DNS服务器一般都是你的网络接入服务器商提供，比如中国电信，中国移动。

2，查询www.163.com的DNS请求到达本地DNS服务器之后，本地DNS服务器会首先查询它的缓存记录，如果缓存中有此条记录，就可以直接返回结果。如果没有，本地DNS服务器还要向DNS根服务器进行查询。

3，根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址。

4，本地DNS服务器继续向域服务器发出请求，在这个例子中，请求的对象是.com域服务器。.com域服务器收到请求之后，也不会直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址。

5，最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系保存在缓存中，以备下次别的用户查询时，可以直接返回结果，加快网络访问。  

##### 关于DNS解析的TTL参数的补充：

我们在配置DNS解析的时候，有一个参数常常容易忽略，就是DNS解析的TTL参数（Time To Live），TTL这个参数告诉本地DNS服务器，域名缓存的最长时间。比如TTL是10分钟，10分钟的含义是，本地DNS服务器对于域名的缓存时间是10分钟，10分钟之后，本地DNS服务器就会删除这条记录，删除之后，如果有用户访问这个域名，就要重复一遍上述复杂的流程。

其实，如果网站已经进入稳定发展的状态，不会轻易更换IP地址，我们完全可以将TTL设置到协议最大值，即24小时。带来的好处是，让域名解析记录能够更长时间的存放在本地DNS服务器中，以加快所有用户的访问。  

而对于近期有计划变更IP地址的用户需要提前把TTL值改小，以便使缓存在世界各地DNS服务器上的旧域名记录迅速过期，等IP地址固定下来后再把TTL值改大。  

##### UDP协议和TCP协议的知识点补充：
==UDP(User Datagram Protocal,用户数据报协议)==,是OSI（Open System Interconnection，开放式系统互联） 参考模型中一种无连接的==传输层协议==(在OSI模型中，在第四层——传输层，处于IP协议的上一层)。  

==TCP(Transmission Control Protocol 传输控制协议)== 是一种面向连接的、可靠的、基于字节流的传输层通信协议，==根据OSI参考模型，UDP和TCP都属于传输层协议==。    

==UDP协议的主要作用==是将网络数据流量压缩成数据包的形式。一个典型的数据包就是一个二进制数据的传输单位。每一个数据包的前8个字节用来包含报头信息，剩余字节则用来包含具体的传输数据。   

==TCP协议的主要作用==是当应用层向TCP层发送用于网间传输的、用8位字节表示的数据流，TCP则把数据流分割成适当长度的报文段，最大传输段大小（MSS）通常受该计算机连接的网络的数据链路层的最大传送单元（MTU）限制。之后TCP把数据包传给IP层，由它来通过网络将包传送给接收端实体的TCP层。  

TCP为了保证报文传输的可靠 ，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的字节发回一个相应的确认(ACK)；如果发送端实体在合理的往返时延(RTT)内未收到确认，那么对应的数据（假设丢失了）将会被重传。   

==UDP协议和TCP协议的主要区别==    

1, TCP协议中包含了专门的传递保证机制，而UDP协议并不提供数据传送的保证机制。  

2, UDP协议具有TCP协议所望尘莫及的速度优势。因为TCP协议中植入了各种安全保障功能，所以在实际执行的过程中会占用大量的系统开销，无疑使速度受到严重的影响，而UDP协议由于排除了信息可靠传递机制，将安全和排序等功能移交给上层应用来完成，极大降低了执行时间，使速度得到了保证。


##### DNS占用53号端口，同时使用TCP协议和UDP协议，那么DNS在什么情况下使用这两种协议？  

==DNS区域传输的时候使用TCP协议：==  

辅域名服务器会定时（一般3小时）向主域名服务器进行查询以便了解数据是否有变动。如有变动，会执行一次区域传送，进行数据同步。区域传送使用TCP，因为数据同步传送的数据量比一个请求应答的数据量要多得多。 并且TCP是一种可靠连接，保证了数据的准确性。  

==域名解析的时候使用UDP协议：== 

客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP协议传输即可。不用经过三次握手，这样DNS服务器负载更低，响应更快，保证时效性。 

关于DNS域名解析的过程，就先说这么多吧。


